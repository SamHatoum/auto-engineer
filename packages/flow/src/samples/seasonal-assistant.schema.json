{
  "variant": "specs",
  "flows": [
    {
      "name": "Seasonal Assistant",
      "slices": [
        {
          "name": "enters shopping criteria into assistant",
          "type": "command",
          "client": {
            "description": "",
            "specs": {
              "name": "Assistant Chat Interface",
              "rules": [
                "allow shopper to describe their shopping needs in natural language",
                "provide a text input for entering criteria",
                "show examples of what to include (age, interests, budget)",
                "show a button to submit the criteria",
                "generate a persisted session id for a visit",
                "show the header on top of the page"
              ]
            }
          },
          "request": "mutation EnterShoppingCriteria($input: EnterShoppingCriteriaInput!) {\n  enterShoppingCriteria(input: $input) {\n    success\n    error {\n      type\n      message\n    }\n  }\n}",
          "server": {
            "description": "",
            "data": [
              {
                "target": {
                  "type": "Event",
                  "name": "ShoppingCriteriaEntered"
                },
                "destination": {
                  "type": "stream",
                  "pattern": "shopping-session-${sessionId}"
                }
              }
            ],
            "specs": {
              "name": "When shopper submits criteria, a shopping session is started",
              "rules": [
                {
                  "description": "Valid criteria should start a shopping session",
                  "examples": [
                    {
                      "description": "User submits shopping criteria for children",
                      "when": {
                        "commandRef": "EnterShoppingCriteria",
                        "exampleData": {
                          "sessionId": "shopper-123",
                          "criteria": "I need back-to-school items for my 7-year-old daughter who loves soccer and crafts, and my 12-year-old son who is into computers and Magic the Gathering."
                        }
                      },
                      "then": [
                        {
                          "eventRef": "ShoppingCriteriaEntered",
                          "exampleData": {
                            "sessionId": "shopper-123",
                            "criteria": "I need back-to-school items for my 7-year-old daughter who loves soccer and crafts, and my 12-year-old son who is into computers and Magic the Gathering."
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        {
          "name": "creates a chat session",
          "type": "react",
          "server": {
            "specs": {
              "name": "When shopping criteria are entered, request wishlist creation",
              "rules": [
                {
                  "description": "Shopping criteria should trigger item suggestion",
                  "examples": [
                    {
                      "description": "Criteria entered triggers wishlist creation",
                      "when": [
                        {
                          "eventRef": "ShoppingCriteriaEntered",
                          "exampleData": {
                            "sessionId": "session-abc",
                            "criteria": "I need back-to-school items for my 7-year-old daughter who loves soccer and crafts, and my 12-year-old son who is into computers and Magic the Gathering."
                          }
                        }
                      ],
                      "then": [
                        {
                          "commandRef": "SuggestShoppingItems",
                          "exampleData": {
                            "sessionId": "session-abc",
                            "prompt": "I need back-to-school items for my 7-year-old daughter who loves soccer and crafts, and my 12-year-old son who is into computers and Magic the Gathering."
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        {
          "name": "selects items relevant to the shopping criteria",
          "type": "command",
          "client": {
            "description": ""
          },
          "server": {
            "description": "",
            "data": [
              {
                "target": {
                  "type": "Command",
                  "name": "SuggestShoppingItems"
                },
                "destination": {
                  "type": "integration",
                  "systems": ["AI"],
                  "message": {
                    "name": "DoChat",
                    "type": "command"
                  }
                },
                "_additionalInstructions": "add the following to the DoChat: schemaName: Products, systemPrompt: use the PRODUCT_CATALOGUE_PRODUCTS MCP tool to get product data",
                "_withState": {
                  "target": {
                    "type": "State",
                    "name": "Products"
                  },
                  "origin": {
                    "type": "integration",
                    "systems": ["ProductCatalog"]
                  }
                }
              },
              {
                "target": {
                  "type": "Event",
                  "name": "ShoppingItemsSuggested"
                },
                "destination": {
                  "type": "stream",
                  "pattern": "shopping-session-${sessionId}"
                }
              }
            ],
            "specs": {
              "name": "When chat is triggered, AI suggests items based on product catalog",
              "rules": [
                {
                  "description": "AI should suggest relevant items from available products",
                  "examples": [
                    {
                      "description": "Product catalog with matching items generates suggestions",
                      "given": [
                        {
                          "exampleData": {
                            "products": [
                              {
                                "productId": "prod-soccer-ball",
                                "name": "Super Soccer Ball",
                                "category": "Sports",
                                "price": 10,
                                "tags": ["soccer", "sports"],
                                "imageUrl": "https://example.com/soccer-ball.jpg"
                              },
                              {
                                "productId": "prod-craft-kit",
                                "name": "Deluxe Craft Kit",
                                "category": "Arts & Crafts",
                                "price": 25,
                                "tags": ["crafts", "art", "creative"],
                                "imageUrl": "https://example.com/craft-kit.jpg"
                              },
                              {
                                "productId": "prod-laptop-bag",
                                "name": "Tech Laptop Backpack",
                                "category": "School Supplies",
                                "price": 45,
                                "tags": ["computers", "tech", "school"],
                                "imageUrl": "https://example.com/laptop-bag.jpg"
                              },
                              {
                                "productId": "prod-mtg-starter",
                                "name": "Magic the Gathering Starter Set",
                                "category": "Games",
                                "price": 30,
                                "tags": ["magic", "tcg", "games"],
                                "imageUrl": "https://example.com/mtg-starter.jpg"
                              }
                            ]
                          },
                          "stateRef": "Products"
                        }
                      ],
                      "when": {
                        "commandRef": "SuggestShoppingItems",
                        "exampleData": {
                          "sessionId": "session-abc",
                          "prompt": "I need back-to-school items for my 7-year-old daughter who loves soccer and crafts, and my 12-year-old son who is into computers and Magic the Gathering."
                        }
                      },
                      "then": [
                        {
                          "eventRef": "ShoppingItemsSuggested",
                          "exampleData": {
                            "sessionId": "session-abc",
                            "suggestedItems": [
                              {
                                "productId": "prod-soccer-ball",
                                "name": "Super Soccer Ball",
                                "quantity": 1,
                                "reason": "Perfect for your daughter who loves soccer"
                              },
                              {
                                "productId": "prod-craft-kit",
                                "name": "Deluxe Craft Kit",
                                "quantity": 1,
                                "reason": "Great for creative activities and crafts"
                              },
                              {
                                "productId": "prod-laptop-bag",
                                "name": "Tech Laptop Backpack",
                                "quantity": 1,
                                "reason": "Essential for your son's school computer needs"
                              },
                              {
                                "productId": "prod-mtg-starter",
                                "name": "Magic the Gathering Starter Set",
                                "quantity": 1,
                                "reason": "Ideal starter set for Magic the Gathering enthusiasts"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        {
          "name": "views suggested items",
          "type": "query",
          "client": {
            "description": "",
            "specs": {
              "name": "Suggested Items Screen",
              "rules": [
                "display all suggested items with names and reasons",
                "show quantity selectors for each item",
                "have an \"Add to Cart\" button for selected items",
                "allow removing items from the suggestions"
              ]
            }
          },
          "request": "query GetSuggestedItems($sessionId: ID!) {\n  suggestedItems(sessionId: $sessionId) {\n    items {\n      productId\n      name\n      quantity\n      reason\n    }\n  }\n}",
          "server": {
            "description": "",
            "data": [
              {
                "target": {
                  "type": "State",
                  "name": "SuggestedItems"
                },
                "origin": {
                  "type": "projection",
                  "name": "SuggestedItemsProjection",
                  "idField": "sessionId"
                }
              }
            ],
            "specs": {
              "name": "Suggested items are available for viewing",
              "rules": [
                {
                  "description": "Items should be available for viewing after suggestion",
                  "examples": [
                    {
                      "description": "Item becomes available after AI suggestion event",
                      "when": {
                        "exampleData": {
                          "sessionId": "session-abc",
                          "suggestedItems": [
                            {
                              "productId": "prod-soccer-ball",
                              "name": "Super Soccer Ball",
                              "quantity": 1,
                              "reason": "Perfect for your daughter who loves soccer"
                            },
                            {
                              "productId": "prod-craft-kit",
                              "name": "Deluxe Craft Kit",
                              "quantity": 1,
                              "reason": "Great for creative activities and crafts"
                            },
                            {
                              "productId": "prod-laptop-bag",
                              "name": "Tech Laptop Backpack",
                              "quantity": 1,
                              "reason": "Essential for your son's school computer needs"
                            },
                            {
                              "productId": "prod-mtg-starter",
                              "name": "Magic the Gathering Starter Set",
                              "quantity": 1,
                              "reason": "Ideal starter set for Magic the Gathering enthusiasts"
                            }
                          ]
                        },
                        "eventRef": "ShoppingItemsSuggested"
                      },
                      "then": [
                        {
                          "stateRef": "SuggestedItems",
                          "exampleData": {
                            "sessionId": "session-abc",
                            "items": [
                              {
                                "productId": "prod-soccer-ball",
                                "name": "Super Soccer Ball",
                                "quantity": 1,
                                "reason": "Perfect for your daughter who loves soccer"
                              },
                              {
                                "productId": "prod-craft-kit",
                                "name": "Deluxe Craft Kit",
                                "quantity": 1,
                                "reason": "Great for creative activities and crafts"
                              },
                              {
                                "productId": "prod-laptop-bag",
                                "name": "Tech Laptop Backpack",
                                "quantity": 1,
                                "reason": "Essential for your son's school computer needs"
                              },
                              {
                                "productId": "prod-mtg-starter",
                                "name": "Magic the Gathering Starter Set",
                                "quantity": 1,
                                "reason": "Ideal starter set for Magic the Gathering enthusiasts"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        {
          "name": "accepts items and adds to their cart",
          "type": "command",
          "client": {
            "description": "",
            "specs": {
              "name": "Suggested Items Screen",
              "rules": [
                "allow selecting specific items to add",
                "update quantities before adding to cart",
                "provide feedback when items are added"
              ]
            }
          },
          "server": {
            "description": "",
            "data": [
              {
                "target": {
                  "type": "Event",
                  "name": "ItemsAddedToCart"
                },
                "destination": {
                  "type": "stream",
                  "pattern": "shopping-session-${sessionId}"
                }
              }
            ],
            "specs": {
              "name": "When shopper accepts items, they are added to cart",
              "rules": [
                {
                  "description": "Accepted items should be added to the shopping cart",
                  "examples": [
                    {
                      "description": "User selects all suggested items for cart",
                      "when": {
                        "commandRef": "AddItemsToCart",
                        "exampleData": {
                          "sessionId": "session-abc",
                          "items": [
                            {
                              "productId": "prod-soccer-ball",
                              "quantity": 1
                            },
                            {
                              "productId": "prod-craft-kit",
                              "quantity": 1
                            },
                            {
                              "productId": "prod-laptop-bag",
                              "quantity": 1
                            },
                            {
                              "productId": "prod-mtg-starter",
                              "quantity": 1
                            }
                          ]
                        }
                      },
                      "then": [
                        {
                          "eventRef": "ItemsAddedToCart",
                          "exampleData": {
                            "sessionId": "session-abc",
                            "items": [
                              {
                                "productId": "prod-soccer-ball",
                                "quantity": 1
                              },
                              {
                                "productId": "prod-craft-kit",
                                "quantity": 1
                              },
                              {
                                "productId": "prod-laptop-bag",
                                "quantity": 1
                              },
                              {
                                "productId": "prod-mtg-starter",
                                "quantity": 1
                              }
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        }
      ],
      "sourceFile": "/Users/ramihatoum/WebstormProjects/xolvio/auto-engineer/examples/shopping-app/flows/shopping-assistant.flow.ts"
    }
  ],
  "messages": [
    {
      "type": "command",
      "name": "DoChat",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "prompt",
          "type": "string",
          "required": true
        },
        {
          "name": "systemPrompt",
          "type": "string",
          "required": false
        },
        {
          "name": "schemaName",
          "type": "string",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "command",
      "name": "AddToCart",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "productId",
          "type": "string",
          "required": true
        },
        {
          "name": "name",
          "type": "string",
          "required": true
        },
        {
          "name": "price",
          "type": "number",
          "required": true
        },
        {
          "name": "quantity",
          "type": "number",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "command",
      "name": "RemoveFromCart",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "productId",
          "type": "string",
          "required": true
        },
        {
          "name": "quantity",
          "type": "number",
          "required": false
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "command",
      "name": "ClearCart",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "state",
      "name": "Cart",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "command",
      "name": "EnterShoppingCriteria",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "criteria",
          "type": "string",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "event",
      "name": "ShoppingCriteriaEntered",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "criteria",
          "type": "string",
          "required": true
        }
      ],
      "source": "internal",
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "command",
      "name": "SuggestShoppingItems",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "prompt",
          "type": "string",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "state",
      "name": "Products",
      "fields": [
        {
          "name": "products",
          "type": "Array<{ productId: string; name: string; category: string; price: number; tags: Array<string>; imageUrl: string }>",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "event",
      "name": "ShoppingItemsSuggested",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "suggestedItems",
          "type": "Array<{ productId: string; name: string; quantity: number; reason: string }>",
          "required": true
        }
      ],
      "source": "internal",
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "state",
      "name": "SuggestedItems",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "items",
          "type": "Array<{ productId: string; name: string; quantity: number; reason: string }>",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "command",
      "name": "AddItemsToCart",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "items",
          "type": "Array<{ productId: string; quantity: number }>",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "event",
      "name": "ItemsAddedToCart",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "items",
          "type": "Array<{ productId: string; quantity: number }>",
          "required": true
        }
      ],
      "source": "internal",
      "metadata": {
        "version": 1
      }
    }
  ],
  "integrations": [
    {
      "name": "AI",
      "description": "AI integration",
      "source": "@auto-engineer/ai-integration"
    },
    {
      "name": "ProductCatalog",
      "description": "ProductCatalog integration",
      "source": "@auto-engineer/productcatalog-integration"
    },
    {
      "name": "Cart",
      "description": "Cart integration",
      "source": "@auto-engineer/cart-integration"
    }
  ]
}
