{
  "variant": "specs",
  "flows": [
    {
      "name": "Seasonal Assistant",
      "slices": [
        {
          "name": "enters shopping criteria into assistant",
          "type": "command",
          "client": {
            "description": "",
            "specs": [
              "Assistant Chat Interface",
              "allow shopper to describe their shopping needs in natural language",
              "provide a text input for entering criteria",
              "show examples of what to include (age, interests, budget)"
            ]
          },
          "server": {
            "description": "",
            "data": [
              {
                "target": {
                  "type": "Event",
                  "name": "ShoppingCriteriaEntered"
                },
                "destination": {
                  "type": "stream",
                  "pattern": "shopping-session-${sessionId}"
                }
              }
            ],
            "gwt": [
              {
                "when": {
                  "commandRef": "EnterShoppingCriteria",
                  "exampleData": {
                    "sessionId": "shopper-123",
                    "criteria": "I need back-to-school items for my 7-year-old daughter who loves soccer and crafts, and my 12-year-old son who is into computers and Magic the Gathering."
                  }
                },
                "then": [
                  {
                    "eventRef": "ShoppingCriteriaEntered",
                    "exampleData": {
                      "sessionId": "session-abc",
                      "criteria": "I need back-to-school items for my 7-year-old daughter who loves soccer and crafts, and my 12-year-old son who is into computers and Magic the Gathering.",
                      "timestamp": "2025-07-18T13:39:09.629Z"
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "name": "finds items in product catalogue",
          "type": "react",
          "server": {
            "description": "",
            "gwt": [
              {
                "when": [
                  {
                    "eventRef": "ShoppingCriteriaEntered",
                    "exampleData": {
                      "sessionId": "session-abc",
                      "criteria": "I need back-to-school items for my 7-year-old daughter who loves soccer and crafts, and my 12-year-old son who is into computers and Magic the Gathering.",
                      "timestamp": "2025-07-18T13:39:09.629Z"
                    }
                  }
                ],
                "then": [
                  {
                    "commandRef": "DoChat",
                    "exampleData": {
                      "sessionId": "session-abc",
                      "prompt": "I need back-to-school items for my 7-year-old daughter who loves soccer and crafts, and my 12-year-old son who is into computers and Magic the Gathering."
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "name": "Do Chat",
          "type": "command",
          "client": {
            "description": "",
            "specs": []
          },
          "server": {
            "description": "",
            "data": [
              {
                "target": {
                  "type": "Command",
                  "name": "DoChat"
                },
                "destination": {
                  "type": "integration",
                  "systems": [
                    "AI"
                  ]
                },
                "_additionalInstructions": "add the following to the DoChat systemPrompt: use the PRODUCT_CATALOGUE_PRODUCTS MCP tool to get product data"
              },
              {
                "target": {
                  "type": "Event",
                  "name": "ChatCompleted"
                },
                "destination": {
                  "type": "stream",
                  "pattern": "shopping-session-${sessionId}"
                }
              }
            ],
            "gwt": [
              {
                "when": {
                  "commandRef": "DoChat",
                  "exampleData": {
                    "sessionId": "session-abc",
                    "prompt": "I need back-to-school items for my 7-year-old daughter who loves soccer and crafts, and my 12-year-old son who is into computers and Magic the Gathering."
                  }
                },
                "then": [
                  {
                    "eventRef": "ChatCompleted",
                    "exampleData": {
                      "sessionId": "session-abc",
                      "suggestedItems": [
                        {
                          "productId": "prod-soccer-ball",
                          "name": "Super Soccer Ball",
                          "quantity": 1,
                          "reason": "Perfect for your daughter who loves soccer"
                        },
                        {
                          "productId": "prod-craft-kit",
                          "name": "Deluxe Craft Kit",
                          "quantity": 1,
                          "reason": "Great for creative activities and crafts"
                        },
                        {
                          "productId": "prod-laptop-bag",
                          "name": "Tech Laptop Backpack",
                          "quantity": 1,
                          "reason": "Essential for your son's school computer needs"
                        },
                        {
                          "productId": "prod-mtg-starter",
                          "name": "Magic the Gathering Starter Set",
                          "quantity": 1,
                          "reason": "Ideal starter set for Magic the Gathering enthusiasts"
                        }
                      ],
                      "timestamp": "2025-07-18T13:39:09.629Z"
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "name": "views suggested items",
          "type": "query",
          "client": {
            "description": "",
            "specs": [
              "Suggested Items Screen",
              "display all suggested items with names and reasons",
              "show quantity selectors for each item",
              "have an \"Add to Cart\" button for selected items",
              "allow removing items from the suggestions"
            ]
          },
          "request": "{\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"query\",\"name\":{\"kind\":\"Name\",\"value\":\"GetSuggestedItems\"},\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"sessionId\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"ID\"}}},\"directives\":[]}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"suggestedItems\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"sessionId\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"sessionId\"}}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"items\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"productId\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"name\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"quantity\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"reason\"},\"arguments\":[],\"directives\":[]}]}}]}}]}}],\"loc\":{\"start\":0,\"end\":229}}",
          "server": {
            "description": "",
            "data": [
              {
                "target": {
                  "type": "State",
                  "name": "SuggestedItems"
                },
                "origin": {
                  "type": "projection",
                  "name": "SuggestedItemsProjection",
                  "idField": "sessionId"
                }
              }
            ],
            "gwt": [
              {
                "given": [],
                "then": [
                  {
                    "stateRef": "SuggestedItems",
                    "exampleData": {
                      "sessionId": "session-abc",
                      "items": [
                        {
                          "productId": "prod-soccer-ball",
                          "name": "Super Soccer Ball",
                          "quantity": 1,
                          "reason": "Perfect for your daughter who loves soccer"
                        },
                        {
                          "productId": "prod-craft-kit",
                          "name": "Deluxe Craft Kit",
                          "quantity": 1,
                          "reason": "Great for creative activities and crafts"
                        },
                        {
                          "productId": "prod-laptop-bag",
                          "name": "Tech Laptop Backpack",
                          "quantity": 1,
                          "reason": "Essential for your son's school computer needs"
                        },
                        {
                          "productId": "prod-mtg-starter",
                          "name": "Magic the Gathering Starter Set",
                          "quantity": 1,
                          "reason": "Ideal starter set for Magic the Gathering enthusiasts"
                        }
                      ]
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "name": "accepts items and adds to their cart",
          "type": "command",
          "client": {
            "description": "",
            "specs": [
              "Suggested Items Screen",
              "allow selecting specific items to add",
              "update quantities before adding to cart",
              "provide feedback when items are added"
            ]
          },
          "server": {
            "description": "",
            "gwt": [
              {
                "when": {
                  "commandRef": "AddItemsToCart",
                  "exampleData": {
                    "sessionId": "session-abc",
                    "items": [
                      {
                        "productId": "prod-soccer-ball",
                        "quantity": 1
                      },
                      {
                        "productId": "prod-craft-kit",
                        "quantity": 1
                      },
                      {
                        "productId": "prod-laptop-bag",
                        "quantity": 1
                      },
                      {
                        "productId": "prod-mtg-starter",
                        "quantity": 1
                      }
                    ]
                  }
                },
                "then": [
                  {
                    "eventRef": "ItemsAddedToCart",
                    "exampleData": {
                      "cartId": "cart-xyz",
                      "items": [
                        {
                          "productId": "prod-soccer-ball",
                          "quantity": 1
                        },
                        {
                          "productId": "prod-craft-kit",
                          "quantity": 1
                        },
                        {
                          "productId": "prod-laptop-bag",
                          "quantity": 1
                        },
                        {
                          "productId": "prod-mtg-starter",
                          "quantity": 1
                        }
                      ],
                      "timestamp": "2025-07-18T13:39:09.630Z"
                    }
                  }
                ]
              }
            ]
          }
        }
      ]
    }
  ],
  "messages": [
    {
      "type": "command",
      "name": "EnterShoppingCriteria",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "criteria",
          "type": "string",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "event",
      "name": "ShoppingCriteriaEntered",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "criteria",
          "type": "string",
          "required": true
        },
        {
          "name": "timestamp",
          "type": "Date",
          "required": true
        }
      ],
      "source": "internal",
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "command",
      "name": "DoChat",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "prompt",
          "type": "string",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "event",
      "name": "ChatCompleted",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "suggestedItems",
          "type": "Array<{productId: string, name: string, quantity: number, reason: string}>",
          "required": true
        },
        {
          "name": "timestamp",
          "type": "Date",
          "required": true
        }
      ],
      "source": "internal",
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "state",
      "name": "SuggestedItems",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "items",
          "type": "Array<{productId: string, name: string, quantity: number, reason: string}>",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "command",
      "name": "AddItemsToCart",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "required": true
        },
        {
          "name": "items",
          "type": "Array<{productId: string, quantity: number}>",
          "required": true
        }
      ],
      "metadata": {
        "version": 1
      }
    },
    {
      "type": "event",
      "name": "ItemsAddedToCart",
      "fields": [
        {
          "name": "cartId",
          "type": "string",
          "required": true
        },
        {
          "name": "items",
          "type": "Array<{productId: string, quantity: number}>",
          "required": true
        },
        {
          "name": "timestamp",
          "type": "Date",
          "required": true
        }
      ],
      "source": "internal",
      "metadata": {
        "version": 1
      }
    }
  ],
  "integrations": [
    {
      "name": "AI",
      "description": "AI integration",
      "source": "@auto-engineer/ai-integration"
    }
  ]
}